# PyCluster üöÄ

**Distributed parallel execution across LAN devices**

PyCluster is a Python library that enables distributed parallel execution of Python functions across multiple devices connected via the same LAN. It provides a simple, secure, and efficient way to distribute computational tasks across your local network without requiring cloud services or complex setup.

## ‚ú® Features

- **üîê Secure Communication**: All communication is encrypted using Fernet encryption
- **üîë One-Time Authentication**: Workers connect using a one-time password (OTP) generated by the host
- **üéØ Simple Decorators**: Use `@remote()` decorator to mark functions for remote execution
- **üìÅ File Transfer**: Built-in support for chunked file transfers
- **üîÑ Async Support**: Full async/await support for modern Python applications
- **üìä Load Balancing**: Automatic task distribution across available workers
- **üõ† CLI Tools**: Easy-to-use command-line interface
- **üåê LAN-Only**: No internet required, works entirely on your local network
- **üîí Auto Key Exchange**: Encryption keys are automatically shared during authentication

## üöÄ Quick Start

### Installation

#### Option 1: Install from GitHub (Recommended)

```bash
# Install directly from GitHub
pip install git+https://github.com/pycluster/pycluster.git

# Or install with development dependencies
pip install git+https://github.com/pycluster/pycluster.git#egg=pycluster[dev]
```

#### Option 2: Clone and Install Locally

```bash
# Clone the repository
git clone https://github.com/pycluster/pycluster.git
cd pycluster

# Install dependencies
pip install -r requirements.txt

# Install the package
pip install -e .
```

#### Option 3: Install from PyPI (Coming Soon)

```bash
# Once published to PyPI
pip install pycluster
```

### Verify Installation

After installation, you can verify everything works:

```bash
# Test the installation
python -c "import pycluster; print('PyCluster installed successfully!')"

# Check CLI availability
python -m pycluster.cli --help
```

### Basic Usage

#### 1. Start the Host (Dispatcher)

```bash
# Start host on default port 8888
pycluster host

# Or specify a custom port
pycluster host --port 9999
```

The host will display a one-time password (OTP) that workers need to connect.

#### 2. Connect Workers

On other devices in your LAN:

```bash
# Connect as a worker (replace with actual host IP and OTP)
pycluster join --host 192.168.1.100 --key ABC12345

# Or specify a custom worker ID
pycluster join --host 192.168.1.100 --key ABC12345 --worker-id my-worker
```

#### 3. Use Remote Functions

```python
from pycluster import remote, set_host, Host
import asyncio

# Set up the host (in your main script)
host = Host(port=8888)
set_host(host)

# Mark functions for remote execution
@remote()
def calculate_fibonacci(n):
    """Calculate the nth Fibonacci number"""
    if n <= 1:
        return n
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b

@remote(computer="worker-1")  # Target specific worker
def heavy_computation(data):
    """Heavy computation that runs on a specific worker"""
    result = 0
    for i in range(data):
        result += i ** 2
    return result

# Use the functions
async def main():
    # These will run on remote workers
    result1 = await calculate_fibonacci(100)
    result2 = await heavy_computation(10000)
    
    print(f"Fibonacci(100) = {result1}")
    print(f"Heavy computation result = {result2}")

# Run the example
asyncio.run(main())
```

## üìñ Documentation

### Architecture

PyCluster consists of three main components:

1. **Host (Dispatcher)**: Central coordinator that manages workers and distributes tasks
2. **Workers**: Devices that connect to the host and execute tasks
3. **Client Library**: Python library for marking and executing remote functions

### Security

PyCluster uses a secure authentication and encryption system:

1. **OTP Authentication**: Each host generates a unique one-time password
2. **Key Exchange**: Encryption keys are automatically shared during authentication
3. **Encrypted Communication**: All messages are encrypted using Fernet (AES-128)
4. **No Persistent Keys**: Each session uses fresh encryption keys

### Configuration

PyCluster can be configured using environment variables:

```bash
# Network settings
export PYCLUSTER_HOST_PORT=8888
export PYCLUSTER_WORKER_PORT=8889
export PYCLUSTER_HOST_ADDRESS="0.0.0.0"

# Security settings
export PYCLUSTER_KEY_SIZE=32
export PYCLUSTER_OTP_LENGTH=8

# File transfer settings
export PYCLUSTER_CHUNK_SIZE=8192
export PYCLUSTER_MAX_FILE_SIZE=104857600  # 100MB

# Timeout settings
export PYCLUSTER_CONNECTION_TIMEOUT=30.0
export PYCLUSTER_TASK_TIMEOUT=300.0
export PYCLUSTER_HEARTBEAT_INTERVAL=10.0

# Logging
export PYCLUSTER_LOG_LEVEL="INFO"
```

### API Reference

#### Host Class

```python
from pycluster import Host

# Create and start host
host = Host(port=8888)
await host.start()

# Get OTP for workers
otp = host.get_otp()

# Execute task manually
result = await host.execute_task("task_id", func, args, kwargs)

# Get worker information
workers = host.get_workers_info()
```

#### Worker Class

```python
from pycluster import Worker

# Create and start worker
worker = Worker(
    worker_id="my-worker",
    host="192.168.1.100",
    port=8888,
    otp="ABC12345"
)
await worker.start()
```

#### Remote Decorator

```python
from pycluster import remote

@remote()  # Run on any available worker
def my_function(x, y):
    return x + y

@remote(computer="worker-1")  # Run on specific worker
def targeted_function(x):
    return x * 2
```

### CLI Commands

```bash
# Start host
pycluster host [--port PORT]

# Join as worker
pycluster join --host HOST --key OTP [--port PORT] [--worker-id ID]

# List workers (future feature)
pycluster list
```

## üîß Advanced Usage

### File Transfer

```python
from pycluster.network import FileTransfer

# Send file to worker
file_transfer = FileTransfer(socket_manager)
await file_transfer.send_file_with_progress(
    "large_dataset.csv",
    progress_callback=lambda sent, total: print(f"Progress: {sent}/{total}")
)
```

### Custom Encryption

```python
from pycluster.network import EncryptionManager

# Use custom encryption key
key = EncryptionManager.generate_key()
encryption_manager = EncryptionManager(key)
```

### Error Handling

```python
from pycluster import remote

@remote()
def risky_function():
    try:
        # Some risky operation
        result = complex_calculation()
        return result
    except Exception as e:
        # Handle errors gracefully
        return f"Error: {e}"

# The error will be returned to the host
result = await risky_function()
```

## üß™ Examples

Check out the `examples/` directory for complete working examples:

- `basic_test.py`: Simple demo showing host, worker, and remote execution
- More examples coming soon!

### Quick Test

Run the automated test to verify everything works:

```bash
python test_cluster.py
```

This will:
1. Start a host automatically
2. Connect a worker
3. Test remote execution
4. Show results

## üîí Security

- **Encryption**: All communication uses Fernet encryption (AES-128)
- **Authentication**: Workers authenticate using one-time passwords
- **Network Isolation**: Works only on your local network
- **Auto Key Exchange**: Encryption keys are automatically shared during authentication
- **No Persistent Keys**: OTPs are generated fresh for each session

## üõ† Development

### Running Tests

```bash
# Install development dependencies
pip install -e ".[dev]"

# Run tests
pytest

# Run with coverage
pytest --cov=pycluster
```

### Code Quality

```bash
# Format code
black pycluster/

# Lint code
flake8 pycluster/

# Type checking
mypy pycluster/
```

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üÜò Support

- **Issues**: [GitHub Issues](https://github.com/pycluster/pycluster/issues)
- **Discussions**: [GitHub Discussions](https://github.com/pycluster/pycluster/discussions)
- **Documentation**: [Read the Docs](https://pycluster.readthedocs.io/)

## üéØ Roadmap

- [ ] Web-based dashboard for monitoring
- [ ] Automatic worker discovery
- [ ] Load balancing algorithms
- [ ] Task scheduling and queuing
- [ ] Docker container support
- [ ] Kubernetes integration
- [ ] Performance monitoring
- [ ] Distributed file system

## üöÄ Getting Started Examples

### Example 1: Simple Remote Function

```python
# Start host: pycluster host --port 8888
# Get OTP from output

# In your Python script:
from pycluster import remote, set_host, Host
import asyncio

host = Host(port=8888)
set_host(host)

@remote()
def add_numbers(a, b):
    return a + b

async def main():
    result = await add_numbers(5, 10)
    print(f"Result: {result}")  # Output: Result: 15

asyncio.run(main())
```

### Example 2: Multiple Workers

```bash
# Terminal 1: Start host
pycluster host --port 8888

# Terminal 2: Connect worker 1
pycluster join --host 127.0.0.1 --port 8888 --key <OTP> --worker-id worker1

# Terminal 3: Connect worker 2  
pycluster join --host 127.0.0.1 --port 8888 --key <OTP> --worker-id worker2
```

### Example 3: Network Deployment

```bash
# On host machine (IP: 192.168.1.100)
pycluster host --port 8888

# On worker machine 1
pycluster join --host 192.168.1.100 --port 8888 --key <OTP>

# On worker machine 2
pycluster join --host 192.168.1.100 --port 8888 --key <OTP>
```

---

**Made with ‚ù§Ô∏è for the Python community** 